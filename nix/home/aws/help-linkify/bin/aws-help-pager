#!/usr/bin/env bash
set -euo pipefail

# aws-help-pager: Pager wrapper that adds hyperlinks to AWS help output
#
# This script is meant to be called by AWS CLI via PAGER environment variable.
# It reads from stdin, adds hyperlinks, and pipes to the user's original pager.

# Get the service and command context from environment variables
SERVICE="${AWS_HELP_SERVICE:-}"
COMMAND="${AWS_HELP_COMMAND:-}"

# Get the directory where this script lives
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Use the original pager that was saved before we replaced PAGER
ORIGINAL_PAGER="${AWS_HELP_ORIGINAL_PAGER:-${PAGER:-less -R}}"

"${SCRIPT_DIR}/aws-help-linkify" "$SERVICE" "$COMMAND" | ${ORIGINAL_PAGER}
