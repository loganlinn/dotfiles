#!/usr/bin/env bash
set -euo pipefail

export AWS_PAGER=""

usage() {
  cat <<EOF
Usage: aws-secretctl-list [OPTIONS]

List all secrets.

Options:
  --arn        Show ARNs instead of names
  -h, --help   Show this help message

Examples:
  aws-secretctl-list
  aws-secretctl-list --arn
  aws-secretctl-list | grep prod
EOF
}

field="Name"

# Parse arguments
while [[ $# -gt 0 ]]; do
  case $1 in
  -h | --help)
    usage
    exit 0
    ;;
  --arn)
    field="ARN"
    shift
    ;;
  -*)
    echo >&2 "Unknown option: $1"
    usage >&2
    exit 1
    ;;
  *)
    echo >&2 "Error: unexpected argument: $1"
    usage >&2
    exit 1
    ;;
  esac
done

aws secretsmanager list-secrets --query "SecretList[].[$field]" --output text
