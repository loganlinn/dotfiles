# ~/.shrc: user-specific run commands for the Bourne shell (sh(1))
# and Bourne compatible shells (bash(1), ksh(1), ash(1), ...).

[ -n "$ENV" ] || . "$HOME"/.profile

alias ":q"=exit

alias ls='ls -lh --color=auto --group-directories-first --classify'
alias cp='cp -i'
alias mv='mv -i'
alias md='mkdir -p'

## directory navigation
alias -- -='cd -'
alias 1='cd -'
alias 2='cd -2'
alias 3='cd -3'
alias 4='cd -4'
alias 5='cd -5'
alias 6='cd -6'
alias 7='cd -7'
alias 8='cd -8'
alias 9='cd -9'

# Prompt if deleting more than 3 files.
alias rm='rm -I'

alias mounts='mount | column -t | sort'
alias ports='netstat -tulanp'

alias less='less -FXr'

# allow aliases to be used with sudo
alias sudo='sudo '

# paths a la printenv(1)
alias printpath='echo $PATH | tr -s ":" "\n"'
alias printfpath='echo $FPATH | tr -s ":" "\n"'

command_exists() {
  command -v "$1" >/dev/null 2>&1
}

function_exists() {
  command -V "$1" >/dev/null 2>&1
}

if command_exists xsel; then
  alias cbc='xsel -i -b'
  alias cbp='xsel -o -b'
elif command_exists pbcopy; then
  alias cbc='pbcopy'
  alias cbp='pbpaste'
fi

if command_exists emacs; then
  alias ec='emacsclient -nc -a ""'
  alias eg='emacsclient -n -a ""'
  alias et='TERM=xterm-256color emacsclient -t -a ""'
fi

## git
alias glr='git pull --rebase'
alias gp='git push -u'
alias glrp='glr && gp'
alias gd='git diff --color'
alias gdc='gd --cached'
alias gs='git status -sb'
alias gw='git show'
alias gsw='git stash show -p'
alias gcob='git checkout -b'
alias gcop='git checkout -p'
alias gopen='git config --get remote.origin.url | sed -r -e '"'"'s|^git@([^:]+):|https://\1/|'"'"' -e '"'"'s|.git$||'"'"' | xargs xdg-open'

if command_exists ag; then
  alias agl='ag -Q'
fi

if command_exists rg; then
  alias rgl='rg -F'
fi

if command_exists tree; then
  alias tree='tree -I .git -a'
fi

if command_exists nix-env; then
  alias nixgc="nix-collect-garbage -d"
  alias nixq="nix-env -qaP"
# alias nixre="darwin-rebuild switch"
fi

if command_exists kubectl; then
  alias k=kubectl
  alias kctx=kubectx
  alias kns=kubens
  alias krew='k krew'
  alias kusers='k config get-users'
  alias kdesc='k describe'
  alias kdoc='k describe'
  alias kgen='k create --dry-run=client -o yaml'
  alias kpf='k port-forward'
  alias kinfo='k cluster-info'
  alias kar='k api-resources --cached'
  alias kav='k api-versions'
  alias kcfg='k config view --raw'
  alias kctxs='k config get-contexts'
  alias kk=kustomize
  alias kkb='kk build'
fi

# dotfiles
alias dotgit='git -C ~/.dotfiles'
alias dotsh='env -C ~/.dotfiles ${=SHELL}'

# kitty
if command_exists kitty; then
  case "$TERM" in
  xterm-kitty)
    alias ssh='kitty +kitten ssh'
    alias kitten='kitty +kitten'
    alias icat='kitty +kitten icat'
    ;;
  esac
fi

if command_exists direnv; then
  alias tmux='direnv exec / tmux'
fi

if command_exists systemctl; then
  alias sc='systemctl'
  alias scs='systemctl status'
  alias scr='systemctl restart'
  alias scu='systemctl --user'
  alias scus='systemctl --user status'
  alias scur='systemctl --user restart'
fi

if command_exists journalctl; then
  alias jc='journalctl'
  alias jcu='journalctl --user-unit'
fi

if command_exists notify-send; then
  alias alert='notify-send --urgency=low -i "$([ $? = 0 ] && echo terminal || echo error)" "$(history|tail -n1|sed -e '\''s/^\s*[0-9]\+\s*//;s/[;&|]\s*alert$//'\'')"'
fi

if command_exists clj; then
# https://github.com/clojure/tools.tools/blob/main/src/clojure/tools/tools/api.clj
  alias clj-tool="clj -Ttools"
  alias clj-tool-install="clj -Ttools install"
  alias clj-tool-ls="clj -Ttools list"
  alias clj-tool-show="clj -Ttools show :tool"
  alias clj-tool-rm="clj -Ttools remove :tool"
# https://github.com/clojure/tools.deps.alpha/blob/master/src/main/clojure/clojure/tools/cli/api.clj
  alias clj-tool-versions="clj -X:deps find-versions :tool"
  alias clj-lib-versions="clj -X:deps find-versions :lib"
  alias deps-install-jar='clj -X:deps mvn-install :jar'
  alias deps-resolve-git-tags='clj -X:deps git-resolve-tags'
  alias deps-prep='clj -X:deps prep'
# https://github.com/clojure/tools.deps.alpha/blob/master/src/main/clojure/clojure/tools/cli/help.clj
  alias clj-doc="clj -X:deps help/doc"
  alias clj-dir="clj -X:deps help/dir"
fi
