#!/usr/bin/env bash

set -e

hash gunzip 2>/dev/null || { echo "gunzip not found in PATH"; exit 1; }

if [[ -e ~/.local/bin/rust-analyzer ]]; then
  read -r -p "$HOME/.local/bin/rust-analyzer already exists. Overwrite? [y/N] " response
  if [[ ! "$response" =~ ^[Yy]$ ]]; then
    echo
    echo "aborted."
    exit 1
  fi
fi
mkdir -p ~/.local/bin
curl -fSLv https://github.com/rust-analyzer/rust-analyzer/releases/latest/download/rust-analyzer-x86_64-unknown-linux-gnu.gz |
  gunzip -c - > ~/.local/bin/rust-analyzer
chmod +x ~/.local/bin/rust-analyzer
echo "installed: $HOME/.local/bin/rust-analyzer"

if ! [[ :$PATH: = *:"$HOME"/.local/bin:* ]]; then
  echo "warning: $HOME/.local/bin is not in PATH"
fi
