[metadata]
name = "aws-secretsmanager"
description = "List and preview secrets in AWS Secrets Manager"
requirements = ["aws", "jq", "pbcopy"]

[source]
command = "aws secretsmanager list-secrets --query 'SecretList[].[Name]' --output text"

[preview]
command = "aws secretsmanager describe-secret --secret-id {} --output json | jq -C ."

[ui]
orientation = "portrait"

[ui.preview_panel]
size = 20

[keybindings]
ctrl-enter = "actions:view"
ctrl-y = "actions:copy"
# ctrl-e = "actions:edit"

[actions.view]
description = "Get secret value"
command = "aws secretsmanager get-secret-value --secret-id {} --output text | pbcopy"
mode = "fork"

# TODO
# [actions.copy]
# description = "Copy secret value"
# command = "aws secretsmanager get-secret-value --secret-id {} --output text | pbcopy"
# mode = "fork"

# TODO
# [actions.edit]
# description = "Edit secret value"
# env = {NVIM_APPNAME = "television"}
# command = """
# secret_id={}
# secret_value=$(aws secretsmanager get-secret-value --secret-id "$secret_id" --output text | vipe) || exit $?
# if gum confirm "Update secret value: $secret_id"; then
#   echo aws secretsmanager put-secret-value --secret-id "$secret_id" --secret-string "$secret_value"
# fi
# """
# mode = "fork"

# TODO
# [actions.delete]
# description = "Delete secret"
# command = "aws secretsmanager delete-secret-value --secret-id {}"
# mode = "fork"
